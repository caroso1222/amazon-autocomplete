"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};(function(window,document,undefined){var numInstances=0;window.AmazonAutocomplete=function(){numInstances++;var self=this;self._id=numInstances;self._input;self._idx;self._words;self._container;self._onSelectedCB=function(){};self._config={delay:150,showWords:true,hideOnblur:true};var args=arguments[0];if(args&&typeof args==="string"){self._config.selector=args}else if(args&&(typeof args==="undefined"?"undefined":_typeof(args))==="object"){Object.keys(args).forEach(function(key){self._config[key]=args[key]})}self._words=[];self._idx=-1;self._keyListenerDebounced=_debounce(_getSuggestions.bind(self),self._config.delay);self._input=document.querySelector(self._config.selector);if(self._input!=null){self._input.setAttribute("autocomplete","off");_buildScriptContainer();if(self._config.showWords){self._input.addEventListener("keyup",_processOnKeyUp.bind(self),false);_buildWordsContainer.call(self);_bindClickListener.call(self)}else{self._input.addEventListener("keyup",_processOnKeyUp__noWords.bind(self),false)}}if(self._config.hideOnblur){self._container.parentNode.classList.add("ac__container--hide-on-blur")}self._input.addEventListener("click",function(e){self._container.parentNode.style.display="block";e.amazonAutocompleteClicked=true});window.AmazonAutocomplete["AmazonJSONPCallbackHandler_"+self._id]=function(body){if(self._config.showWords){_paintWords.call(self,body[0],body[1])}if(self._onWordsCB!=null){self._onWordsCB(body[1])}}};document.body.addEventListener("click",function(evt){if(!evt.amazonAutocompleteClicked){var elems=document.querySelectorAll(".ac__container--hide-on-blur");var elemsArr=Array.prototype.slice.call(elems);elemsArr.forEach(function(elem){return elem.style.display="none"})}});AmazonAutocomplete.prototype.onSelectedWord=function(cb){this._onSelectedCB=cb};AmazonAutocomplete.prototype.onNewWords=function(cb){this._onWordsCB=cb};function _buildWordsContainer(){var container=document.createElement("div");container.className="ac__container";container.style.width=this._input.offsetWidth;container.style.position="relative";this._input.parentNode.insertBefore(container,this._input.nextSibling);var inner=document.createElement("div");inner.className="ac__inner";inner.style.position="absolute";inner.style.top=0;inner.style.left=0;inner.style.width="100%";container.appendChild(inner);this._container=inner}function _getStringFromWordElement(wordElement){return wordElement.firstChild.innerHTML+wordElement.lastChild.textContent}function _bindClickListener(){var _this=this;this._container.addEventListener("click",function(e){if(e.target!==e.currentTarget)_this._onSelectedCB(_getStringFromWordElement(e.target));e.stopPropagation()})}function _flushWordsContainer(){while(this._container.firstChild){this._container.removeChild(this._container.firstChild)}}function _debounce(f,delay){var flag=true;return function(){var _arguments=arguments;if(flag){flag=false;setTimeout(function(){f.apply(null,Array.prototype.slice.apply(_arguments));flag=true},delay)}}}function _unselectWord(wordElement){if(wordElement!=null)wordElement.className=wordElement.className.split(" ").filter(function(obj){return!/ac__word--selected/.test(obj)}).join(" ")}function _processOnKeyUp__noWords(evt){var key=evt.keyCode||evt.which;var char=String.fromCharCode(key);if(key==13){this._onSelectedCB(this._input.value)}else if(/[a-zA-Z0-9-_ ]/.test(char)||key===8){var prefix=encodeURIComponent(this._input.value);if(prefix!="")this._keyListenerDebounced(prefix)}}function _processOnKeyUp(evt){var key=evt.keyCode||evt.which;var char=String.fromCharCode(key);var self=this;if(key===38){if(self._idx>0){_unselectWord(self._words[self._idx]);self._idx--}self._words[self._idx].className+=" ac__word--selected"}else if(key==40){if(self._idx<self._words.length-1){_unselectWord(self._words[self._idx]);self._idx++}self._words[self._idx].className+=" ac__word--selected"}else if(key==13){if(self._words.length&&self._idx>-1)self._onSelectedCB(_getStringFromWordElement(self._words[self._idx]));else self._onSelectedCB(self._input.value)}else if(/[a-zA-Z0-9-_ ]/.test(char)||key===8){self._idx=-1;var prefix=encodeURIComponent(self._input.value);if(prefix!="")self._keyListenerDebounced(prefix);else _flushWordsContainer.call(self)}}function _buildScriptContainer(){var parent=document.getElementById("ac__script");if(parent==null){parent=document.createElement("div");parent.id="ac__script";parent.appendChild(document.createElement("script"));document.body.appendChild(parent)}}function _paintWords(prefix,words){_flushWordsContainer.call(this);this._words=[];var docFrag=document.createDocumentFragment();for(var i=0;i<words.length;i++){var wordElement=document.createElement("p");wordElement.className="ac__word";wordElement.style.cursor="pointer";var prefixElement=document.createElement("span");prefixElement.className="ac__prefix";prefixElement.style.pointerEvents="none";var suffix=document.createTextNode(words[i].slice(prefix.length));prefixElement.appendChild(document.createTextNode(prefix));wordElement.appendChild(prefixElement);wordElement.appendChild(suffix);docFrag.appendChild(wordElement);this._words.push(wordElement)}this._container.appendChild(docFrag)}function _getSuggestions(prefix){var scriptContainer=document.getElementById("ac__script");var newScript=document.createElement("script");newScript.src=document.location.protocol+"//completion.amazon.com/search/complete?search-alias=aps&client=amazon-search-ui&mkt=1&q="+prefix+"&callback=AmazonAutocomplete.AmazonJSONPCallbackHandler_"+this._id;scriptContainer.replaceChild(newScript,scriptContainer.firstChild)}})(window,document);